# 💤 EEG 기반 수면 단계 분류 모델

**Zzz Lab | 2025년 1학기 인공지능 프로젝트**

---

## 👥 팀 소개

| 이름  | 역할                  |
| --- | ------------------- |
| 박서현 | 자료조사, 모델링, Flask 제작 |
| 송은주 | 자료조사, Flask 제작      |
| 정민규 | 자료조사, 데이터 전처리, 모델링  |
| 박찬양 | 자료조사, 데이터 전처리, 모델링  |

## 🔍 문제 정의

* 수면의 질을 평가하기 위해 병원에서 \*\*수면다원검사(PSG)\*\*를 활용함
* PSG는 EEG를 비롯한 다양한 생체신호를 측정해 수면 단계를 분류
* **EEG**는 가장 핵심적인 분석 지표로, 전문가의 눈으로 수면 단계를 판독함
* 다만,

  * 고비용·고인력 구조
  * 주관적 해석에 의한 편차 발생
* 따라서, **보다 효율적이고 자동화된 수면 단계 분석 기술**의 필요성이 제기됨

## 🧠 프로젝트 요약

| 항목             | 설명                        |
| -------------- | ------------------------- |
| 📅 EDF 업로드     | 사용자 EEG 수면 파일 (.edf) 업로드  |
| 🧠 수면 단계 예측    | CNN+BiLSTM 기반 수면 단계 분류    |
| 📊 결과 시각화      | 각 수면 단계 비율 + 이상적 수면 비율 비교 |
| 💡 피드백 시스템     | 부족한 단계에 대한 원인 분석 및 보완 제안  |
| 👤 계정 기반 분석 기록 | 회원가입, 로그인, 분석 리포트 저장      |
| 📈 점수 추이 시각화   | 수면 점수 변화를 선그래프로 표현        |

## 🗂 디렉토리별 설명

### 📁 `app/`

수면 분석 및 웹 서비스를 위한 핵심 기능 구현

* `app.py` : Flask 서버 및 분석 흐름 전체 관리

  * 사용자 로그인/회원가입 관리 (`user_model.py`)
  * EDF 업로드 후 `process_edf()` 통해 자동 전처리 및 예측
  * 결과 페이지 렌더링 (`/result`, `/score_chart`)
* `feedback.py`: 예측된 수면 단계 비율에 따라 피드백 메시지 동적으로 생성
* `sleepbot_result.md`: 사용자별 리포트 생성 포맷 정의

### 📁 `model/`

딥러닝 기반 수면 단계 분류 모델 구성

* `model_architecture.py`: Conv1D + BiLSTM 기반 네트워크 정의

  * Conv1D 3단 → BiLSTM(2-layer, 256 hidden) → Dropout → FC
  * 입력: (B, 1, T) 형태의 EEG 시계열
* `models.py`: 모델 초기화 및 저장, 불러오기 관련 함수 정의
* `user_model.py`: 로그인 사용자별 데이터 처리 관련 모듈

## 📊 실험 결과

| Class     | W    | N1   | N2   | N3   | REM  |
| --------- | ---- | ---- | ---- | ---- | ---- |
| Precision | 0.66 | 0.63 | 0.69 | 0.71 | 0.35 |
| Recall    | 0.78 | 0.47 | 0.52 | 0.85 | 0.66 |
| F1-score  | 0.72 | 0.54 | 0.60 | 0.77 | 0.46 |

* **N3**, **Wake 단계**는 비교적 높은 F1-score → 안정적인 분류
* **N1**, **N2**, **REM** 단계는 여전히 개선 여지 있음 (under-representation 가능성)

## 📚 참고 문헌

Goldberger, A. L., Goldberger, Z. D., & Goldberger, A. L. (2000). *Sleep-EDF Expanded Database*. PhysioNet. [https://physionet.org/content/sleep-edfx/1.0.0/](https://physionet.org/content/sleep-edfx/1.0.0/)
